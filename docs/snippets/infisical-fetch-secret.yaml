apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: infisical-managed-secrets
spec:
  secretStoreRef:
    kind: SecretStore
    name: infisical

  target:
    name: auth-api

  data:
    - secretKey: API_KEY
      remoteRef:
        # Get infisical Secret From SecretStore.secretPath (for example /) + key => /API_KEY
        key: API_KEY
    - secretKey: API_TOKEN
      remoteRef:
        # Get infisical Secret From SecretStore.secretPath (for example /) + key => /BACKEND/API_TOKEN
        key: /BACKEND/API_TOKEN
    - secretKey: API_SECRET      
      remoteRef:
        # Get infisical Secret From SecretStore.secretPath (for example /) + key => /API/API_TOKEN
        key: API/API_TOKEN     

---

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: infisical-managed-secrets-tls
  namespace: cma
spec:
  secretStoreRef:
    kind: SecretStore
    name: infisical
  target:
    name: infisical-tls
    template:
      type: kubernetes.io/tls

      data:
        tls.crt: |
          {{ .tlsCert }}
        tls.key: |
          {{ .tlsKey }}

  data:
    - secretKey: tlsCert
      remoteRef:
        key: /TLS/TLS_CRT
    - secretKey: tlsKey
      remoteRef:
        key: /TLS/TLS_KEY