apiVersion: external-secrets.io/v1
kind: SecretStore
metadata:
  name: infisical-aws-auth
spec:
  provider:
    infisical:
      # Optional (default: https://app.infisical.com).
      #
      # Override this if you are using a different Infisical instance.
      hostAPI: https://app.infisical.com

      auth:
        awsAuthCredentials:
          identityId:
            # Option 1: Specify the Machine Identity ID directly (recommended for AWS environments)
            value: "<machine-identity-id>"

            # Option 2: Reference a secret containing the Machine Identity ID
            # secretRef:
            #   name: infisical-aws-auth
            #   key: identityId
            #   # namespace is required for ClusterSecretStore
            #   # namespace: external-secrets
      secretsScope:
        projectSlug: my-project
        # "dev", "staging", "prod", etc.
        environmentSlug: dev
        # Optional (default: `/`).
        secretsPath: /
        # Optional (default: false).
        recursive: false
