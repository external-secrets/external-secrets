{% raw %}
apiVersion: v1
kind: Secret
metadata:
  name: source-certificate
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUREVENDQWZXZ0F3SUJBZ0lVUXRZRzdDQlJMZmVKNStBOVQrQUVjaEx1TTBBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0ZqRVVNQklHQTFVRUF3d0xaSFZ0YlhrdWJHOWpZV3d3SGhjTk1qWXdNakUzTVRBeU56UXdXaGNOTWpjdwpNakUzTVRBeU56UXdXakFXTVJRd0VnWURWUVFEREF0a2RXMXRlUzVzYjJOaGJEQ0NBU0l3RFFZSktvWklodmNOCkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFKL0t4MUxlTElBMC9xT1RPdHlHUWpaVGRxUjFmTGo5bGU3T0tZREEKd01Fb0Z1K1B3SHBGT3VpRiszS05aeThiTEpnUnlDMkI2TXNvQWZFTm9RaWxiS3JMTUNnZExLQ3hNUzFpM1o1TgpUNXA4K2huSWE4MHVCbjBtZjQ3TG5adkp3VzVIc1ZwZktsdTNDYi9uT1QwS3Bnb3NWYk9iazNYRDNEYVFKUzU0CjZmV2lqMzZKS1RhWnlSZE1zenB4TlpxZ1g1K2NtVTY2YmVrek5lc2NnWlRFRVdvRXhySXgzelZ6RjVJUHM3a1AKN1pLbjZubVhwUEtUbldiWDRzSDNlL1NwU2FNOWh4NTRhdFU4M05OUzdiNm1yZlo3THV2ZWoyTUlwdGVFUE5UawpJWEljNjR1RkJnMUpjdGRtWHFQeUFnYkduNmNzOFZiS3hpTGQ2TEo0SWVmaUZ5OENBd0VBQWFOVE1GRXdIUVlEClZSME9CQllFRk1McStORVRlS3JlS1RmWGtUYzFHNCtGWTRwT01COEdBMVVkSXdRWU1CYUFGTUxxK05FVGVLcmUKS1RmWGtUYzFHNCtGWTRwT01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQgpBQ0lhQVJmV1czcm5KVDRDWWROY085eVdxOHQvdTRDV3hSK1RFd1hic0VhNWpxQWt6OVZRd0FzaDRoQnNuaUhDCjNWRDBYZ1lNK0tFaHZuWnUwdU9HSWJrdURQM1ZkVittU3lFUGVmd1VDSXFQWUgzNk81K1RBWDNBTXg4dEt2Z0oKQUFXRkIvd0hMZDNBYXpaNU84NytZUVo2RzZOREU5NDhrTDMyeUprd3BrN3kwSHljSCtyMjhUNG51MTNxTzBMdgpyWXBKRzJVK2lYWDh2djFuVk9Ec1o1UXc1YnJ4UktBbEJVdTRJOUp2M2VqRVVHRm5uUTZ2Z0RXRldMcGxRby9rCk9ISGdvU1dPNDNuS2hiUk43SEVka0VQTGxDZEttcWJzRUE3bTBocnZlNUovWHRQUklJUG5mdjR2cEhXd2dmRkYKRzJ1US9HZDFKa1VMV0tGa2lZcUFwMU09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ2Z5c2RTM2l5QU5QNmoKa3pyY2hrSTJVM2FrZFh5NC9aWHV6aW1Bd01EQktCYnZqOEI2UlRyb2hmdHlqV2N2R3l5WUVjZ3RnZWpMS0FIeApEYUVJcFd5cXl6QW9IU3lnc1RFdFl0MmVUVSthZlBvWnlHdk5MZ1o5Sm4rT3k1MmJ5Y0Z1UjdGYVh5cGJ0d20vCjV6azlDcVlLTEZXem01TjF3OXcya0NVdWVPbjFvbzkraVNrMm1ja1hUTE02Y1RXYW9GK2ZuSmxPdW0zcE16WHIKSElHVXhCRnFCTWF5TWQ4MWN4ZVNEN081RCsyU3ArcDVsNlR5azUxbTErTEI5M3YwcVVtalBZY2VlR3JWUE56VApVdTIrcHEzMmV5N3IzbzlqQ0tiWGhEelU1Q0Z5SE91TGhRWU5TWExYWmw2ajhnSUd4cCtuTFBGV3lzWWkzZWl5CmVDSG40aGN2QWdNQkFBRUNnZ0VBUGQ4bWpzKzRLMnhackx5MWJlNE9kVHFjRmRIb0dUa1hkUUFlMGR2UXh2bmUKNTZPaHc3Wkt1UDRuL3BNQ0FSdGtpUDFacFVWSC9tSGZYcGNJWTNDcVF2ZXFEZDQrQ1hxU3NDQTM3N08vdnZIbApaVlpWWjMwS3hpckIrV2lkL2xTQXNWTFJPVXpmK2VORnd5aWs0UjNlYk5IOTNTM0FTemtyYTNVazhIbWhIWnJYCmxCcy9HTHBhQ2cxeUQ0WFg2TlpnbnJHMXNrUnJndWhZV0VrS1NlbE9vNEFsOEd3SEsyTWJUR29xVUpLcE9UYSsKWVFuckZtbTFwSlpIR0c4THE2cVllOGk2V3lhRDJ2Y04rUEdOelBackFUNGdZcXhtVVQwdHN1aGpiYzVmYXU2QgpscFFMZzNZbVF5blhlSzNhc2phN1RhRGttMXdpOUg2anRUUTliTUkwQVFLQmdRREtjc0ttSHhpL3RNUWQ4UkQ2CkJpa1VzVm4vUEs2eFdEMkU0U0ZmVmNSelcwTVlRaVFDSGdUZVVnWGZyS0oxSHRHYXhIZEcwUTgvR0xsMU5oQ0kKSFZjcTIwVkFzM1FXRzVoRjRXaDFaMnFDMjRBV2VFZndEWkYxRTRhb1cwcHp3WGdkd2VkTzRMUFk4aUFiREZkegpKMVJDRTUrRUlLZGs5eEhUanc5YVFmb2ZzUUtCZ1FES0QzV2N0MTVPR2lVeFBkWDlJRzJETm1OVEFrbHJJL2V0CktLS25ZYXAzZ3lXcGJaejF0bnEvRU5uU0tpaHkyRHhvcGQ2MlFqeEJ3Sm56c1hNRVc4Ync0Q3RoZndYMGdpc2UKREJISlluM0laN2lUd3pKMHZxdlRWcWNwRXNNd2dHY0VuZEVHQjNGWXdLSUFHSzRPRUtuQlNRU3dFdkZiMW80dAp5NjZsR0lNODN3S0JnUUNEd2c3WENUUVZTTE8rL083Y21uZlFKT0Q2MGVhc08wN0dsYk1mbGZWbVVvWW5XcHlPCjJEUzQ4TThyMVBKaW9XMHZlaUJhOGFNbm9KTExLeVcxUU10RGREUHRPUjRiYVZoQVdzU2ViSEVRdTRUd210WE8KOFRXeTZjTmcvUkZHcHlyaXl4a2M1L2VGQVloTnNrbVVBNHU5K1lGKy83V1NhNDZwanRraUdBQ084UUtCZ1FDaApxS2F2UUdHWjJQOGltMWRtRWhpcjNzcXVjZWp0YURSUy9Hek52NnpUdTBCWmdsSU9uL1VxZ2ovVERsbVlNSHA4Ck95Q283dXNvckFBLzRSdWxSQXd4VVJoRUE0MXZKdWw2TzZ2TFZCcFFTUE42ZkxRVWhTd1JoSVZ1cmcwdDg3ejQKQzQ5YzVIMkJ4WFNXNFNmNEpzcTUwa0tHNEZEcjZnZU1paVhxL21hWlB3S0JnRldYWXVPNWk1WmZpeHM4QWg1WgpBQ0pOV0UwMkw5VlF5bk9LcEVpcy91WGZuWHF2dlpmMEM3dksrMTVNVitHZGpvcjhWWURZTE1NUzVoV1pwL1loClNxTVM5MUg0Z1NXY043eGZDdTNBSmE1WVdES3dkelZxTmhkRG9qbXJQWklVSXhVeUQvSWE3SlhDWTk3S1BVblIKOEJBTSs0L3JZelpFWnZjaE9ob1RTQUc5Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
---
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: pushsecret-example
  namespace: default
spec:
  refreshInterval: 1h0m0s # Refresh interval for which push secret will reconcile
  deletionPolicy: Delete
  secretStoreRefs: # A list of secret stores to push secrets to
    - name: azure-store
      kind: SecretStore
  selector:
    secret:
      name: source-certificate # Source Kubernetes secret to be pushed
  template:
    engineVersion: v2
    data:
      # The template uses the `pemToPkcs12` function to convert the PEM-encoded certificate and key into a P12 file, which is then base64 decoded before being pushed to Azure Key Vault
      cert.p12: '{{ pemToPkcs12 (index . "tls.crt" | toString) (index . "tls.key" | toString) | b64dec }}'
  data:
    - match:
        secretKey: cert.p12 # Reference to the generated P12 file in the template data
        remoteRef:
          remoteKey: cert/my-azkv-cert-name
{% endraw %}
